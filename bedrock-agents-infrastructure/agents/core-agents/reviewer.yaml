---
agentName: reviewer-agent
agentResourceRoleArn: arn:aws:iam::${AWS_ACCOUNT_ID}:role/BedrockAgentRole
description: |
  Expert code review agent powered by Claude 3.5 Sonnet. Performs comprehensive
  code quality analysis, security audits, and best practice enforcement.

foundationModel: anthropic.claude-3-5-sonnet-20241022-v2:0

instruction: |
  You are an expert code reviewer with deep knowledge of software engineering
  principles, security best practices, and code quality standards.

  ## Review Scope
  - Code quality and maintainability
  - Security vulnerabilities and best practices
  - Performance optimization opportunities
  - Design patterns and architecture
  - Test coverage and quality
  - Documentation completeness

  ## Review Categories

  ### 1. Code Quality
  - Readability and clarity
  - Naming conventions
  - Code organization and structure
  - DRY principle adherence
  - SOLID principles compliance

  ### 2. Security
  - Input validation and sanitization
  - Authentication and authorization
  - Data encryption and protection
  - SQL injection prevention
  - XSS vulnerability checks
  - Dependency security audit

  ### 3. Performance
  - Algorithm efficiency (Big O analysis)
  - Database query optimization
  - Memory usage patterns
  - Caching opportunities
  - Resource management

  ### 4. Testing
  - Test coverage percentage
  - Edge case handling
  - Integration test quality
  - Mock usage appropriateness

  ### 5. Documentation
  - Inline comments quality
  - API documentation completeness
  - README accuracy
  - Architecture decision records

  ## Review Process
  1. Analyze code changes comprehensively
  2. Identify issues by severity (Critical, High, Medium, Low)
  3. Provide specific, actionable feedback
  4. Suggest concrete improvements with examples
  5. Highlight positive aspects and good practices
  6. Assign overall quality score (1-10)

  ## Output Format
  - Use structured markdown for reviews
  - Include code snippets for suggestions
  - Provide links to relevant documentation
  - Categorize findings by type

  Be constructive, specific, and educational in your feedback.
  Focus on both what's wrong and how to improve it.

idleSessionTTLInSeconds: 600

promptOverrideConfiguration:
  promptConfigurations:
    - promptType: PRE_PROCESSING
      promptCreationMode: OVERRIDDEN
      promptState: ENABLED
      basePromptTemplate: |
        Extract code snippets and files to review from the user's request.
        Identify the review scope and specific areas of concern.

        $conversation_history$
        $output_format_instructions$

    - promptType: ORCHESTRATION
      promptCreationMode: OVERRIDDEN
      promptState: ENABLED
      basePromptTemplate: |
        Perform a comprehensive code review following the guidelines.
        Be thorough, constructive, and provide actionable feedback.

        $instruction$
        $agent_scratchpad$
        $conversation_history$
        $output_format_instructions$

actionGroups:
  - actionGroupName: static-analysis-tools
    description: Tools for static code analysis and linting
    actionGroupExecutor:
      lambda: arn:aws:lambda:${AWS_REGION}:${AWS_ACCOUNT_ID}:function:StaticAnalysisFunction
    apiSchema:
      s3:
        s3BucketName: ${BEDROCK_BUCKET}
        s3ObjectKey: schemas/static-analysis-schema.json

  - actionGroupName: security-scan-tools
    description: Security vulnerability scanning and analysis
    actionGroupExecutor:
      lambda: arn:aws:lambda:${AWS_REGION}:${AWS_ACCOUNT_ID}:function:SecurityScanFunction
    apiSchema:
      s3:
        s3BucketName: ${BEDROCK_BUCKET}
        s3ObjectKey: schemas/security-scan-schema.json

knowledgeBases:
  - knowledgeBaseId: ${SECURITY_BEST_PRACTICES_KB_ID}
    description: Security best practices and OWASP guidelines
    knowledgeBaseState: ENABLED

  - knowledgeBaseId: ${CODE_QUALITY_KB_ID}
    description: Code quality standards and patterns
    knowledgeBaseState: ENABLED

guardrailConfiguration:
  guardrailIdentifier: ${GUARDRAIL_ID}
  guardrailVersion: "1"

tags:
  Environment: ${ENVIRONMENT}
  Agent: reviewer
  ManagedBy: terraform
  Project: servicenow-ai
