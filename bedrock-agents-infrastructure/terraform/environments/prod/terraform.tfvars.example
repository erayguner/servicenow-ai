# Production Environment Configuration Example
# Copy this file to terraform.tfvars and update with your actual production values
# IMPORTANT: Keep terraform.tfvars in .gitignore - NEVER commit production secrets

# ============================================================================
# AWS REGIONS
# ============================================================================
aws_region       = "us-east-1"
secondary_region = "us-west-2"
dr_region        = "eu-west-1"

# ============================================================================
# OWNERSHIP & CONTACTS
# ============================================================================
owner_email = "prod-ops@example.com"

operational_contacts = {
  primary_oncall   = "primary-oncall@example.com"
  secondary_oncall = "secondary-oncall@example.com"
  escalation_email = "engineering-leads@example.com"
  slack_channel    = "#prod-alerts-servicenow-ai"
}

# ============================================================================
# AGENT CONFIGURATION
# ============================================================================
agent_instruction = <<-EOT
  You are a ServiceNow AI assistant in production environment.
  Provide accurate, reliable, and secure responses for ServiceNow operations.
  Prioritize data integrity, security, and compliance in all interactions.
  Follow enterprise security policies and audit requirements.
  Maintain high availability and performance standards.

  CRITICAL GUIDELINES:
  - Never expose sensitive data or credentials
  - Always validate user permissions before executing actions
  - Log all actions for audit compliance
  - Follow SOX, PCI, and HIPAA requirements
  - Escalate critical issues immediately
EOT

# ============================================================================
# DATA SOURCES
# ============================================================================
data_source_bucket_arn           = "arn:aws:s3:::servicenow-ai-data-prod-primary"
data_source_bucket_arn_secondary = "arn:aws:s3:::servicenow-ai-data-prod-secondary"

# ============================================================================
# LAMBDA CONFIGURATION
# ============================================================================
action_lambda_arn           = "arn:aws:lambda:us-east-1:123456789012:function:servicenow-actions-prod"
action_lambda_arn_secondary = "arn:aws:lambda:us-west-2:123456789012:function:servicenow-actions-prod"

# ============================================================================
# ALERTS & NOTIFICATIONS
# ============================================================================
alert_email         = "prod-critical-alerts@example.com"
alert_sns_topic_arn = "arn:aws:sns:us-east-1:123456789012:servicenow-ai-prod-alerts"

# PagerDuty Integration
enable_pagerduty          = true
pagerduty_integration_key = "YOUR_PAGERDUTY_INTEGRATION_KEY"  # Store in AWS Secrets Manager

# ============================================================================
# TERRAFORM STATE BACKEND
# ============================================================================
state_bucket_name     = "servicenow-ai-terraform-state-prod"
state_lock_table_name = "servicenow-ai-terraform-locks-prod"

# ============================================================================
# SECURITY & ENCRYPTION
# ============================================================================
kms_key_id = "arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012"

security_config = {
  enable_waf              = true
  enable_shield_advanced  = true
  enable_secrets_rotation = true
  mfa_required            = true
  ip_whitelist            = [
    # Add your corporate IP ranges
    # "203.0.113.0/24",
    # "198.51.100.0/24"
  ]
}

# WAF Rules
waf_rules = [
  {
    name     = "rate-limit-api"
    priority = 1
    action   = "block"
  },
  {
    name     = "geo-blocking-high-risk"
    priority = 2
    action   = "block"
  },
  {
    name     = "sql-injection-protection"
    priority = 3
    action   = "block"
  },
  {
    name     = "xss-protection"
    priority = 4
    action   = "block"
  },
  {
    name     = "known-bad-inputs"
    priority = 5
    action   = "block"
  }
]

enable_shield_advanced = true

# ============================================================================
# AUTO-SCALING CONFIGURATION
# ============================================================================
auto_scaling_config = {
  min_instances        = 5
  max_instances        = 20
  desired_instances    = 8
  scale_up_threshold   = 70
  scale_down_threshold = 30
}

# ============================================================================
# PERFORMANCE CONFIGURATION
# ============================================================================
performance_config = {
  provisioned_units           = 100
  cache_ttl_seconds           = 3600
  max_concurrent_requests     = 100
  lambda_provisioned_capacity = 10
}

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================
backup_config = {
  retention_days                = 30
  schedule                      = "cron(0 2 * * ? *)"  # Daily at 2 AM UTC
  enable_point_in_time_recovery = true
}

# ============================================================================
# MONITORING THRESHOLDS
# ============================================================================
monitoring_thresholds = {
  error_rate_percent   = 0.05  # 5% error rate triggers alert
  latency_ms           = 2000  # 2 seconds P99 latency
  availability_percent = 99.9  # 99.9% uptime SLA
  throttle_count       = 1000  # Throttle alert threshold
}

# ============================================================================
# COMPLIANCE CONFIGURATION
# ============================================================================
compliance_config = {
  frameworks           = ["sox", "pci", "hipaa"]
  enable_audit_logging = true
  log_retention_days   = 90
  enable_encryption    = true
}

# ============================================================================
# BUSINESS CONTINUITY
# ============================================================================
business_continuity_config = {
  enable_multi_region       = true
  enable_automatic_failover = true
  rpo_minutes               = 15  # Recovery Point Objective
  rto_minutes               = 30  # Recovery Time Objective
}

# ============================================================================
# SYNTHETIC MONITORING
# ============================================================================
synthetic_test_scenarios = [
  {
    name        = "agent-health-check"
    description = "Basic agent health and availability check"
    frequency   = "5min"
  },
  {
    name        = "knowledge-base-query-test"
    description = "Knowledge base retrieval functionality"
    frequency   = "10min"
  },
  {
    name        = "action-group-execution-test"
    description = "Action group functionality validation"
    frequency   = "15min"
  },
  {
    name        = "end-to-end-workflow-test"
    description = "Complete workflow from query to response"
    frequency   = "30min"
  }
]

# ============================================================================
# COST ALLOCATION TAGS
# ============================================================================
cost_allocation_tags = {
  Department   = "Engineering"
  Application  = "ServiceNow-AI"
  CostCenter   = "PROD-OPS-001"
  BusinessUnit = "IT-Operations"
  Service      = "AI-Agent-Platform"
  Billing      = "production"
}

# ============================================================================
# CHANGE MANAGEMENT
# ============================================================================
change_window = {
  day_of_week    = "Sunday"
  start_hour     = 2  # 2 AM UTC
  duration_hours = 4
}

# ============================================================================
# RESOURCE ESTIMATES
# ============================================================================

# Expected Monthly Costs:
# -------------------------
# Bedrock Agents (Primary):        $800-1200/month (8 instances, provisioned)
# Bedrock Agents (Secondary):      $800-1200/month (8 instances, provisioned)
# OpenSearch Provisioned:          $400-600/month (HA cluster)
# Lambda Provisioned:              $100-150/month (provisioned concurrency)
# CloudWatch Logs & Metrics:       $80-120/month (90-day retention)
# X-Ray Tracing:                   $40-60/month
# S3 Storage & Replication:        $50-80/month
# Data Transfer (Multi-region):    $100-200/month
# WAF & Shield Advanced:           $200-300/month
# Synthetics Monitoring:           $30-50/month
# Backup Storage:                  $50-100/month
# -------------------------
# TOTAL ESTIMATED:                 $2,500-4,000/month

# ============================================================================
# DEPLOYMENT INSTRUCTIONS
# ============================================================================

# 1. Initialize Terraform:
#    terraform init \
#      -backend-config="bucket=servicenow-ai-terraform-state-prod" \
#      -backend-config="key=bedrock-agents/prod/terraform.tfstate" \
#      -backend-config="dynamodb_table=servicenow-ai-terraform-locks-prod"

# 2. Create workspace (if using workspaces):
#    terraform workspace new prod

# 3. Plan changes:
#    terraform plan -var-file="terraform.tfvars" -out=prod.plan

# 4. Apply changes (requires approval):
#    terraform apply prod.plan

# 5. Verify deployment:
#    terraform output

# ============================================================================
# SECURITY REMINDERS
# ============================================================================

# - Store this file as terraform.tfvars (gitignored)
# - Use AWS Secrets Manager for sensitive values
# - Rotate credentials every 90 days
# - Enable MFA for all production access
# - Review IAM permissions quarterly
# - Monitor CloudTrail for suspicious activity
# - Keep Terraform and providers updated
# - Use separate AWS accounts for environments
# - Enable GuardDuty and Security Hub
# - Implement least privilege access

# ============================================================================
# RUNBOOK LINKS
# ============================================================================

# - Incident Response: https://wiki.example.com/incident-response
# - Disaster Recovery: https://wiki.example.com/dr-runbook
# - Deployment Guide: https://wiki.example.com/deployment-guide
# - Monitoring Guide: https://wiki.example.com/monitoring-guide
# - Security Policies: https://wiki.example.com/security-policies

# ==============================================================================
# SECURITY MODULE CONFIGURATION
# ==============================================================================

# KMS Key Administrators (Production Security Team)
kms_key_admin_arns = [
  "arn:aws:iam::123456789012:role/ProductionSecurityAdmin",
  "arn:aws:iam::123456789012:role/ComplianceTeam",
  "arn:aws:iam::123456789012:role/InfrastructureAdmin"
]

# KMS Grant Role ARNs (for cross-service access)
kms_grant_role_arns = [
  # "arn:aws:iam::123456789012:role/BackupService",
  # "arn:aws:iam::123456789012:role/MonitoringService"
]

# DynamoDB Tables for Lambda Access
dynamodb_table_arns = [
  "arn:aws:dynamodb:us-east-1:123456789012:table/servicenow-sessions-prod",
  "arn:aws:dynamodb:us-east-1:123456789012:table/servicenow-cache-prod",
  "arn:aws:dynamodb:us-east-1:123456789012:table/servicenow-audit-prod"
]

# Cross-Account Access (for backup/monitoring accounts)
enable_cross_account_access = true
trusted_account_ids = [
  # "098765432109",  # Backup account
  # "098765432108",  # Monitoring account
]
cross_account_external_id = "REPLACE_WITH_SECURE_EXTERNAL_ID"  # Store in AWS Secrets Manager

# WAF Configuration - IP Filtering
waf_blocked_ips = [
  # Add known malicious IPs or ranges
  # "192.0.2.0/24",
  # "198.51.100.0/24",
]

waf_allowed_ips = [
  # Corporate network ranges (if using IP whitelisting)
  # "203.0.113.0/24",  # Corporate HQ
  # "198.51.100.0/24",  # Remote office
  # "192.0.2.0/24",    # VPN gateway
]

# WAF Geo-blocking (Block high-risk countries)
waf_blocked_countries = [
  # "CN",  # China
  # "RU",  # Russia
  # "KP",  # North Korea
  # "IR",  # Iran
  # "SY",  # Syria
]

# API Key Requirements (Production API Security)
require_api_key = true
api_key_value   = "REPLACE_WITH_SECURE_API_KEY"  # Store in AWS Secrets Manager

# API Gateway ARNs for WAF Association
api_gateway_arn_primary   = "arn:aws:apigateway:us-east-1::/restapis/abc123xyz456"
api_gateway_arn_secondary = "arn:aws:apigateway:us-west-2::/restapis/def456uvw789"

# GuardDuty Configuration
enable_guardduty_org_config = true  # Enable if using AWS Organizations
threat_intel_location       = "s3://servicenow-ai-security-prod/threat-intel/malicious-ips.txt"
trusted_ip_set_location     = "s3://servicenow-ai-security-prod/threat-intel/trusted-ips.txt"
guardduty_processor_zip_path = "./lambda/guardduty-findings-processor.zip"

# Critical Alerts SNS Topic (for high-severity findings)
critical_alert_sns_topic_arn = "arn:aws:sns:us-east-1:123456789012:critical-security-alerts"

# Compliance Frameworks
enable_pci_compliance  = true  # Enable if processing payment data
enable_nist_compliance = true  # Enable for government compliance

# Security Hub Organization Configuration
enable_security_hub_org_config = true  # Enable if using AWS Organizations

# ==============================================================================
# MONITORING MODULE CONFIGURATION
# ==============================================================================

# Lambda Functions to Monitor (Production Functions)
lambda_function_names = [
  "servicenow-actions-prod",
  "servicenow-processor-prod",
  "servicenow-integrations-prod",
  "servicenow-analytics-prod",
  "servicenow-notifications-prod",
  "servicenow-workflows-prod"
]

# Step Functions State Machines
step_function_arns = [
  "arn:aws:states:us-east-1:123456789012:stateMachine:servicenow-incident-workflow-prod",
  "arn:aws:states:us-east-1:123456789012:stateMachine:servicenow-change-workflow-prod",
  "arn:aws:states:us-east-1:123456789012:stateMachine:servicenow-approval-workflow-prod"
]

# API Gateway REST APIs to Monitor
api_gateway_ids = [
  "abc123xyz456",  # Primary API
  "def456uvw789"   # Secondary API
]

# Alert Email Addresses (Distribution Lists)
alert_email_addresses = [
  "prod-ops-team@example.com",
  "platform-engineering@example.com",
  "sre-team@example.com",
  "security-team@example.com"
]

# Bedrock Agent Endpoints for Synthetic Monitoring
bedrock_agent_endpoints_primary = [
  "https://bedrock-agent-runtime.us-east-1.amazonaws.com/agents/AGENT_ID_PRIMARY/agentAliases/ALIAS_ID",
  "https://api-gateway.us-east-1.amazonaws.com/prod/bedrock-agent"
]

bedrock_agent_endpoints_secondary = [
  "https://bedrock-agent-runtime.us-west-2.amazonaws.com/agents/AGENT_ID_SECONDARY/agentAliases/ALIAS_ID",
  "https://api-gateway.us-west-2.amazonaws.com/prod/bedrock-agent"
]

# CloudTrail Configuration
enable_mfa_delete        = true   # Require MFA to delete CloudTrail logs
enable_organization_trail = true  # Enable if using AWS Organizations

# AWS Config Configuration
config_custom_rules = [
  # Add custom compliance rules
  # {
  #   name        = "bedrock-encryption-enabled"
  #   description = "Ensure all Bedrock resources use encryption"
  #   source      = "custom-rule-lambda-arn"
  # }
]

enable_config_aggregator    = true
config_aggregator_accounts = [
  # "098765432109",  # Development account
  # "098765432108",  # Staging account
]

# CloudWatch Synthetics VPC Configuration (for private endpoints)
enable_synthetics_vpc = false  # Set to true if testing private endpoints
synthetics_vpc_id     = ""     # VPC ID if testing private endpoints
synthetics_subnet_ids = []     # Private subnet IDs for canaries

# ==============================================================================
# COST ESTIMATE - PRODUCTION WITH FULL SECURITY & MONITORING
# ==============================================================================
# 
# AGENT INFRASTRUCTURE (Multi-Region HA):
# - Bedrock Agents (8 instances, provisioned): ~$800-1200/month
# - OpenSearch Provisioned: ~$400-600/month
# - Lambda (provisioned capacity): ~$150-250/month
# - Step Functions: ~$50-100/month
# 
# SECURITY MODULES:
# - GuardDuty (full protections, multi-region): ~$150-250/month
# - Security Hub (all standards): ~$50-80/month
# - WAF (advanced rules, multi-region): ~$100-150/month
# - Shield Advanced (optional): ~$3000/month
# - KMS (multi-region, rotation): ~$10-15/month
# - Secrets Manager (rotation, replicas): ~$10-20/month
# 
# MONITORING MODULES:
# - CloudWatch (comprehensive, multi-region): ~$200-300/month
# - X-Ray (100% sampling): ~$100-150/month
# - CloudTrail (multi-region, insights): ~$50-75/month
# - Config (all rules, aggregator): ~$30-50/month
# - EventBridge (cross-region): ~$20-30/month
# - Synthetics (multi-location, frequent): ~$50-75/month
# 
# STORAGE & TRANSFER:
# - S3 (versioning, replication): ~$100-200/month
# - Data transfer (multi-region): ~$100-300/month
# - Backup storage: ~$50-100/month
# 
# TOTAL ESTIMATED COST:
# - Without Shield Advanced: ~$2,420-3,945/month (~$29,000-47,000/year)
# - With Shield Advanced: ~$5,420-6,945/month (~$65,000-83,000/year)
# 
# NOTE: Costs vary based on:
# - Request volume and data processing
# - Multi-region data transfer
# - GuardDuty findings volume
# - CloudWatch log ingestion
# - X-Ray trace sampling rate
# - Synthetics test frequency
# 
# COST OPTIMIZATION RECOMMENDATIONS:
# - Use Savings Plans for predictable workloads
# - Enable S3 Intelligent-Tiering
# - Review CloudWatch log retention policies
# - Optimize X-Ray sampling rates after baseline
# - Use Reserved Capacity for OpenSearch
# - Enable Cost Anomaly Detection

# ==============================================================================
# COMPLIANCE & AUDIT COMMANDS
# ==============================================================================

# View Security Hub compliance score:
# aws securityhub get-findings-summary --region us-east-1

# Export GuardDuty findings:
# aws guardduty list-findings --detector-id <detector-id> --output json > guardduty-findings.json

# Check WAF block rate:
# aws wafv2 get-web-acl-for-resource --resource-arn <api-arn> --scope REGIONAL

# View CloudTrail audit logs:
# aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=InvokeAgent

# Check Config compliance:
# aws configservice describe-compliance-by-config-rule

# Export all monitoring dashboards:
# aws cloudwatch list-dashboards --region us-east-1

# ==============================================================================
# DISASTER RECOVERY & BACKUP
# ==============================================================================

# Backup retention: 30 days
# RTO (Recovery Time Objective): < 1 hour
# RPO (Recovery Point Objective): < 5 minutes
#
# Failover procedure:
# 1. Verify secondary region health
# 2. Update Route 53 DNS records
# 3. Activate secondary Bedrock agents
# 4. Validate traffic routing
# 5. Monitor performance metrics
#
# Runbook: https://wiki.example.com/bedrock-dr-runbook

# ==============================================================================
# SERVICENOW MODULE CONFIGURATION
# ==============================================================================

# ServiceNow Instance URL (Production)
servicenow_instance_url = "https://prod12345.service-now.com"

# Authentication Type (OAuth strongly recommended for production)
servicenow_auth_type = "oauth"

# ServiceNow Credentials - Primary Region
# IMPORTANT: Create secret in AWS Secrets Manager first
# Secret format: {"username":"service_account","password":"...","client_id":"...","client_secret":"..."}
servicenow_credentials_secret_arn = "arn:aws:secretsmanager:us-east-1:123456789012:secret:servicenow-prod-credentials-xxxxx"

# ServiceNow Credentials - Secondary Region (replicated)
servicenow_credentials_secret_arn_secondary = "arn:aws:secretsmanager:us-west-2:123456789012:secret:servicenow-prod-credentials-xxxxx"

# VPC Configuration - Primary Region (Required for production)
servicenow_vpc_id     = "vpc-0123456789abcdef0"
servicenow_subnet_ids = [
  "subnet-0a1b2c3d4e5f6g7h8",  # Private subnet 1a
  "subnet-1b2c3d4e5f6g7h8i9",  # Private subnet 1b
  "subnet-2c3d4e5f6g7h8i9j0"   # Private subnet 1c
]
servicenow_security_group_ids = [
  "sg-0123456789abcdef0"  # ServiceNow integration security group
]

# VPC Configuration - Secondary Region
servicenow_vpc_id_secondary     = "vpc-9876543210fedcba9"
servicenow_subnet_ids_secondary = [
  "subnet-9a8b7c6d5e4f3g2h1",  # Private subnet 2a
  "subnet-8b7c6d5e4f3g2h1i0",  # Private subnet 2b
  "subnet-7c6d5e4f3g2h1i0j9"   # Private subnet 2c
]
servicenow_security_group_ids_secondary = [
  "sg-9876543210fedcba9"  # ServiceNow integration security group (secondary)
]

# IP Restrictions (Corporate network ranges only)
servicenow_allowed_ip_ranges = [
  "203.0.113.0/24",   # Corporate HQ
  "198.51.100.0/24",  # Remote office 1
  "192.0.2.0/24",     # Remote office 2
  "10.0.0.0/8"        # Internal VPN ranges
]

# ==============================================================================
# SERVICENOW FEATURES - PRODUCTION CONFIGURATION
# ==============================================================================

# All features enabled in production:
# ✓ Incident automation with AI-powered triage
# ✓ Intelligent ticket triage and routing
# ✓ Change management with approval workflows
# ✓ Problem management and root cause analysis
# ✓ Knowledge base synchronization (daily at 2 AM UTC)
# ✓ SLA monitoring with breach alerts (75% threshold)
# ✓ Auto-assignment with 90% confidence threshold
# ✓ Multi-region deployment with automatic failover
# ✓ Comprehensive monitoring and alerting
# ✓ Enhanced security with VPC, encryption, and IP restrictions

# ==============================================================================
# SERVICENOW COST ESTIMATE - PRODUCTION
# ==============================================================================
#
# PRIMARY REGION:
# - API Gateway (production traffic): ~$50-100/month
# - Lambda (provisioned capacity): ~$100-150/month
# - DynamoDB (PAY_PER_REQUEST): ~$75-125/month
# - Step Functions (workflows): ~$50-75/month
# - CloudWatch (logs, metrics, alarms): ~$40-60/month
# - Secrets Manager: ~$2/month
#
# SECONDARY REGION (Failover):
# - API Gateway: ~$50-100/month
# - Lambda: ~$100-150/month
# - DynamoDB (with replication): ~$75-125/month
# - Step Functions: ~$50-75/month
# - CloudWatch: ~$40-60/month
# - Secrets Manager: ~$2/month
#
# TOTAL SERVICENOW MODULE COST: ~$634-1,024/month
#
# NOTE: Costs vary based on:
# - Number of ServiceNow incidents/tickets processed
# - Workflow execution frequency
# - DynamoDB read/write patterns
# - API Gateway request volume
# - Lambda execution duration
#
# COST OPTIMIZATION:
# - Use DynamoDB on-demand pricing for variable workloads
# - Optimize Lambda memory and timeout settings
# - Enable CloudWatch log retention policies
# - Use API Gateway caching for frequent queries
# - Monitor and adjust auto-scaling thresholds

# ==============================================================================
# SERVICENOW INTEGRATION SETUP - PRODUCTION
# ==============================================================================

# Prerequisites:
# 1. Production ServiceNow instance with admin access
# 2. AWS Secrets Manager secrets created in both regions
# 3. VPCs and subnets configured with proper routing
# 4. Security groups allowing Lambda to ServiceNow communication
# 5. PagerDuty or SNS topics for critical alerts
# 6. Runbook for incident response and failover procedures

# Setup Steps:
#
# 1. Create ServiceNow OAuth Application:
#    - Navigate to System OAuth > Application Registry
#    - Create OAuth API endpoint for external clients
#    - Configure redirect URIs
#    - Set appropriate scopes (incident, change, problem, knowledge)
#    - Note Client ID and Client Secret
#
# 2. Store Credentials in AWS Secrets Manager (Primary):
#    aws secretsmanager create-secret \
#      --region us-east-1 \
#      --name servicenow-prod-credentials \
#      --description "ServiceNow production credentials - PRIMARY" \
#      --secret-string '{"username":"svc_bedrock_agent","password":"STRONG_PASSWORD","client_id":"CLIENT_ID","client_secret":"CLIENT_SECRET"}' \
#      --kms-key-id <kms-key-id>
#
# 3. Replicate Secret to Secondary Region:
#    aws secretsmanager replicate-secret-to-regions \
#      --secret-id servicenow-prod-credentials \
#      --add-replica-regions Region=us-west-2,KmsKeyId=<secondary-kms-key-id>
#
# 4. Deploy Infrastructure:
#    terraform init
#    terraform plan -var-file="terraform.tfvars" -out=prod.plan
#    terraform apply prod.plan
#
# 5. Configure ServiceNow Webhooks:
#    - Use API Gateway endpoints from Terraform outputs
#    - Set up webhooks for incident, change, problem events
#    - Configure authentication headers
#    - Test webhooks with sample events
#
# 6. Verify Multi-Region Setup:
#    - Test primary region functionality
#    - Test secondary region functionality
#    - Verify DynamoDB replication
#    - Test failover scenarios
#
# 7. Enable Monitoring:
#    - Configure CloudWatch dashboards
#    - Set up SNS alert subscriptions
#    - Enable X-Ray tracing
#    - Configure PagerDuty integration
#
# 8. Production Readiness Checklist:
#    ☐ OAuth credentials tested and working
#    ☐ All workflows tested end-to-end
#    ☐ Failover tested successfully
#    ☐ Monitoring and alerting verified
#    ☐ Security groups and VPC configuration validated
#    ☐ IAM roles and permissions reviewed
#    ☐ Backup and recovery procedures documented
#    ☐ Runbooks created and team trained
#    ☐ Load testing completed
#    ☐ Security scan completed

# ==============================================================================
# SERVICENOW MONITORING & TROUBLESHOOTING
# ==============================================================================

# Monitor API Gateway:
# aws apigateway get-rest-api --rest-api-id <primary-api-id>
# aws apigateway get-rest-api --rest-api-id <secondary-api-id> --region us-west-2

# Check DynamoDB Tables:
# aws dynamodb describe-table --table-name servicenow-sessions-prod-primary
# aws dynamodb describe-table --table-name servicenow-sessions-prod-secondary --region us-west-2

# Monitor Step Functions:
# aws stepfunctions list-executions --state-machine-arn <incident-workflow-arn> --max-results 10
# aws stepfunctions list-executions --state-machine-arn <change-workflow-arn> --max-results 10

# View Lambda Logs:
# aws logs tail /aws/lambda/servicenow-incident-handler-prod --follow
# aws logs tail /aws/lambda/servicenow-change-handler-prod --follow

# Check Secrets:
# aws secretsmanager describe-secret --secret-id servicenow-prod-credentials
# aws secretsmanager get-secret-value --secret-id servicenow-prod-credentials --query SecretString

# Test Webhook:
# curl -X POST https://<api-gateway-url>/prod/webhook/incident \
#   -H "Content-Type: application/json" \
#   -d '{"number":"INC0001234","short_description":"Test incident","priority":"3"}'

# ==============================================================================
# SERVICENOW OPERATIONAL PROCEDURES
# ==============================================================================

# Incident Response:
# 1. Check CloudWatch dashboard for system health
# 2. Review recent Lambda executions for errors
# 3. Verify ServiceNow connectivity
# 4. Check API Gateway metrics
# 5. Review Step Functions execution history
# 6. Escalate to on-call engineer if unresolved

# Failover Procedure:
# 1. Verify secondary region health
# 2. Update Route 53 DNS to point to secondary API Gateway
# 3. Monitor DynamoDB replication lag
# 4. Verify workflow executions in secondary region
# 5. Document failover event and root cause

# Rollback Procedure:
# 1. Identify last known good Terraform state
# 2. Revert to previous configuration
# 3. Apply Terraform changes
# 4. Verify system functionality
# 5. Update runbooks with lessons learned
