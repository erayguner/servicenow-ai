# Staging Environment Configuration Example
# Copy this file to terraform.tfvars and update with your values

# AWS Configuration
aws_region = "eu-west-2"

# Owner Information
owner_email = "qa-team@example.com"

# Agent Configuration
agent_instruction = <<-EOT
  You are a ServiceNow AI assistant in staging environment.
  This environment mirrors production for testing and validation.
  Provide production-quality responses while allowing for testing scenarios.
  Support comprehensive testing of all ServiceNow integrations.
EOT

# Data Sources
data_source_bucket_arn = "arn:aws:s3:::servicenow-ai-data-staging"

# Lambda Configuration
action_lambda_arn = "arn:aws:lambda:us-east-1:123456789012:function:servicenow-actions-staging"

# Alerts
alert_email = "staging-alerts@example.com"

# Backend Configuration
state_bucket_name     = "servicenow-ai-terraform-state-staging"
state_lock_table_name = "servicenow-ai-terraform-locks-staging"

# Testing Configuration
enable_load_testing   = true
enable_chaos_testing  = true
enable_ab_testing     = true

# Load Test Configuration
load_test_config = {
  target_rps          = 50
  duration_minutes    = 30
  ramp_up_minutes     = 5
  concurrent_sessions = 100
}

# Test Scenarios
test_scenarios = [
  "functional-testing",
  "integration-testing",
  "performance-testing",
  "security-testing",
  "regression-testing"
]

# QA Team
qa_team_members = [
  "qa-lead@example.com",
  "qa-engineer1@example.com",
  "qa-engineer2@example.com",
  "automation-engineer@example.com"
]

# Monitoring
enable_synthetic_monitoring = true

# Data Sync
sync_with_prod = false

# Approval
approval_required = true

# Compliance
enable_audit_logging = true
compliance_framework = "sox"

# Example resource naming:
# - Agent: servicenow-ai-agent-staging
# - Knowledge Base: servicenow-ai-kb-staging
# - Log Group: /aws/bedrock/agent/servicenow-ai-staging
# - Orchestrator: servicenow-ai-orchestrator-staging

# Action Groups Enabled:
# - servicenow-read
# - servicenow-write
# - servicenow-query
# - analytics-actions
# - notification-actions
# - workflow-actions

# Cost Estimate:
# - Bedrock Agent (3 instances): ~$150-250/month
# - OpenSearch Serverless: ~$80-120/month
# - Lambda executions: ~$20-40/month
# - CloudWatch logs (30 days): ~$20-30/month
# - X-Ray tracing: ~$10-20/month
# - S3 storage: ~$10-15/month
# - Data transfer: ~$10-25/month
# Total: ~$300-500/month

# Testing Commands:
# terraform init -backend-config="bucket=servicenow-ai-terraform-state-staging"
# terraform plan -var-file="terraform.tfvars" -out=staging.plan
# terraform apply staging.plan

# Load Testing:
# artillery run load-test.yml --target https://bedrock-agent-runtime.us-east-1.amazonaws.com

# Monitoring:
# aws cloudwatch get-metric-statistics \
#   --namespace AWS/Bedrock \
#   --metric-name Invocations \
#   --dimensions Name=AgentId,Value=AGENT_ID

# Performance Testing:
# Test concurrent sessions: 100
# Target RPS: 50
# Duration: 30 minutes
# Expected latency: < 3 seconds

# ==============================================================================
# Security Module Configuration
# ==============================================================================

# KMS Key Administrators
kms_key_admin_arns = [
  "arn:aws:iam::123456789012:role/SecurityAdmin",
  "arn:aws:iam::123456789012:role/InfrastructureAdmin"
]

# DynamoDB Tables
dynamodb_table_arns = [
  # "arn:aws:dynamodb:us-east-1:123456789012:table/servicenow-sessions-staging",
  # "arn:aws:dynamodb:us-east-1:123456789012:table/servicenow-cache-staging"
]

# WAF IP Filtering
waf_blocked_ips = [
  # "192.0.2.0/24",  # Example blocked range
]

waf_allowed_ips = [
  # "203.0.113.0/24",  # Example corporate network
]

# WAF Geo-blocking
waf_blocked_countries = [
  # "CN",  # China
  # "RU",  # Russia
  # "KP",  # North Korea
]

# API Gateway ARN for WAF
api_gateway_arn = ""  # Will be populated after API Gateway creation

# ==============================================================================
# Monitoring Module Configuration
# ==============================================================================

# Lambda Functions to Monitor
lambda_function_names = [
  "servicenow-actions-staging",
  "servicenow-processor-staging",
  "servicenow-integrations-staging"
]

# Step Functions to Monitor
step_function_arns = [
  # "arn:aws:states:us-east-1:123456789012:stateMachine:servicenow-workflow-staging"
]

# API Gateway IDs to Monitor
api_gateway_ids = [
  # "abc123def456"
]

# Bedrock Agent Endpoints for Synthetic Monitoring
bedrock_agent_endpoints = [
  # "https://bedrock-agent-runtime.us-east-1.amazonaws.com/agents/AGENT_ID/agentAliases/ALIAS_ID"
]

# ==============================================================================
# Cost Estimate with Full Security & Monitoring
# ==============================================================================
# AGENT INFRASTRUCTURE:
# - Bedrock Agent (3 instances): ~$150-250/month
# - OpenSearch Serverless: ~$80-120/month
# - Lambda executions: ~$20-40/month
#
# SECURITY MODULES:
# - GuardDuty (with protections): ~$30-50/month
# - Security Hub: ~$10-20/month
# - WAF (with managed rules): ~$20-35/month
# - KMS (with rotation): ~$3-5/month
# - Secrets Manager (with rotation): ~$2-4/month
#
# MONITORING MODULES:
# - CloudWatch (dashboards, logs, alarms): ~$40-60/month
# - X-Ray (enhanced tracing): ~$15-25/month
# - CloudTrail (multi-event): ~$10-15/month
# - Config (compliance tracking): ~$5-10/month
# - EventBridge: ~$5/month
# - Synthetics (canaries): ~$10-15/month
#
# STORAGE & TRANSFER:
# - S3 storage: ~$15-25/month
# - Data transfer: ~$10-25/month
#
# Total: ~$425-700/month
#
# NOTE: All security and monitoring modules are enabled in staging
# This provides full testing coverage before production deployment

# ==============================================================================
# Security Commands
# ==============================================================================
# View GuardDuty findings:
# aws guardduty list-findings --detector-id <detector-id>
#
# Check Security Hub score:
# aws securityhub get-findings-summary
#
# View WAF metrics:
# aws wafv2 get-web-acl-for-resource --resource-arn <api-gateway-arn>

# ==============================================================================
# ServiceNow Module Configuration
# ==============================================================================

# ServiceNow Instance Configuration (Required for staging)
servicenow_instance_url = "https://staging12345.service-now.com"

# Authentication Type
servicenow_auth_type = "oauth"

# ServiceNow Credentials Secret (create in AWS Secrets Manager)
servicenow_credentials_secret_arn = "arn:aws:secretsmanager:us-east-1:123456789012:secret:servicenow-staging-credentials-xxxxx"

# VPC Configuration (optional - for private ServiceNow instances)
servicenow_vpc_id             = null  # "vpc-0123456789abcdef0"
servicenow_subnet_ids         = []    # ["subnet-abc123", "subnet-def456"]
servicenow_security_group_ids = []    # ["sg-0123456789abcdef0"]

# IP Restrictions (optional - restrict API Gateway access)
servicenow_allowed_ip_ranges = [
  # "203.0.113.0/24",  # Corporate network
]

# ServiceNow Features Enabled in Staging:
# ✓ Incident automation
# ✓ Ticket triage with AI
# ✓ Change management
# ✓ Problem management
# ✓ Knowledge base sync
# ✓ SLA monitoring

# Cost Estimate with ServiceNow Module:
# - API Gateway: ~$15-25/month
# - Lambda executions: ~$30-50/month
# - DynamoDB: ~$20-30/month
# - Step Functions: ~$10-15/month
# - CloudWatch logs: ~$10-15/month
# Total Additional: ~$85-135/month

# ==============================================================================
# Monitoring Commands
# ==============================================================================
# View CloudWatch dashboard:
# https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#dashboards:name=servicenow-ai-staging-bedrock
#
# View X-Ray traces:
# aws xray get-trace-summaries --start-time <start> --end-time <end>
#
# View CloudTrail events:
# aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=InvokeAgent
#
# Monitor ServiceNow Integration:
# aws apigateway get-rest-api --rest-api-id <api-id>
# aws dynamodb describe-table --table-name servicenow-sessions-staging
# aws stepfunctions list-executions --state-machine-arn <workflow-arn>

# ==============================================================================
# ServiceNow Integration Setup
# ==============================================================================
# 1. Create OAuth application in ServiceNow staging instance
# 2. Store credentials in AWS Secrets Manager:
#    aws secretsmanager create-secret \
#      --name servicenow-staging-credentials \
#      --secret-string '{"username":"...","password":"...","client_id":"...","client_secret":"..."}'
# 3. Deploy infrastructure
# 4. Configure ServiceNow webhooks with API Gateway endpoints from outputs
# 5. Test all features comprehensively before promoting to production
