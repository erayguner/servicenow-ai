# GDPR Compliance Framework for Amazon Bedrock Agents
# General Data Protection Regulation (EU) 2016/679

framework:
  name: 'GDPR'
  version: '2016/679'
  effective_date: '2018-05-25'
  jurisdiction: 'European Union'
  scope: 'Processing of personal data in Amazon Bedrock Agents'
  territorial_scope:
    - 'Processing in context of EU establishment'
    - 'Offering goods/services to EU data subjects'
    - 'Monitoring behavior of EU data subjects'

# Principles (Article 5)
principles:
  lawfulness_fairness_transparency:
    article: '5(1)(a)'
    requirements:
      - lawful_basis_for_processing
      - transparent_information_provision
      - fair_processing_practices
    aws_mappings:
      - service: 'Bedrock'
        checks:
          - bedrock_processing_purpose_documented
          - bedrock_legal_basis_identified
      - service: 'CloudTrail'
        checks:
          - processing_activities_logged
          - audit_trail_maintained

  purpose_limitation:
    article: '5(1)(b)'
    requirements:
      - specific_explicit_legitimate_purposes
      - no_further_incompatible_processing
    aws_mappings:
      - service: 'Bedrock'
        checks:
          - bedrock_agent_purpose_defined
          - bedrock_knowledge_base_purpose_limited
      - service: 'Tags'
        checks:
          - purpose_tags_applied
          - data_processing_purpose_labeled

  data_minimisation:
    article: '5(1)(c)'
    requirements:
      - adequate_relevant_limited_data
      - necessary_for_purposes
    aws_mappings:
      - service: 'Bedrock'
        checks:
          - bedrock_minimal_data_collection
          - unnecessary_data_fields_excluded
      - service: 'S3'
        checks:
          - lifecycle_policies_configured
          - data_retention_limits_enforced

  accuracy:
    article: '5(1)(d)'
    requirements:
      - accurate_data_maintained
      - inaccurate_data_erased_rectified
    aws_mappings:
      - service: 'Bedrock'
        checks:
          - bedrock_knowledge_base_update_procedures
          - data_quality_validation_enabled
      - service: 'DynamoDB'
        checks:
          - data_validation_rules_implemented

  storage_limitation:
    article: '5(1)(e)'
    requirements:
      - retention_period_defined
      - archival_for_public_interest
    aws_mappings:
      - service: 'S3'
        checks:
          - lifecycle_policies_configured
          - object_expiration_configured
      - service: 'Bedrock'
        checks:
          - bedrock_data_retention_policy
          - automated_deletion_configured
      - service: 'Glacier'
        checks:
          - archival_policies_compliant

  integrity_confidentiality:
    article: '5(1)(f)'
    requirements:
      - appropriate_security_measures
      - protection_against_unauthorized_processing
      - protection_against_loss_damage
    aws_mappings:
      - service: 'KMS'
        checks:
          - encryption_at_rest_enabled
          - cmk_for_personal_data
      - service: 'Bedrock'
        checks:
          - bedrock_knowledge_base_encrypted
          - bedrock_api_tls_enforced
      - service: 'GuardDuty'
        checks:
          - threat_detection_enabled
          - unauthorized_access_monitored

  accountability:
    article: '5(2)'
    requirements:
      - controller_responsibility_demonstrated
      - compliance_evidence_maintained
    aws_mappings:
      - service: 'Config'
        checks:
          - compliance_tracking_enabled
          - configuration_history_maintained
      - service: 'Audit Manager'
        checks:
          - gdpr_assessment_framework_configured
          - evidence_collection_automated

# Lawful Basis for Processing (Article 6)
lawful_basis:
  consent:
    article: '6(1)(a)'
    requirements:
      - freely_given_specific_informed_unambiguous
      - clear_affirmative_action
      - withdrawal_as_easy_as_giving
    aws_mappings:
      - service: 'DynamoDB'
        implementation:
          - consent_records_table
          - timestamp_consent_given
          - consent_version_tracked
      - service: 'Bedrock'
        checks:
          - bedrock_consent_verification_implemented

  contract:
    article: '6(1)(b)'
    requirements:
      - necessary_for_contract_performance
      - pre_contractual_steps
    aws_mappings:
      - service: 'Bedrock'
        implementation:
          - contract_processing_purpose_tagged

  legal_obligation:
    article: '6(1)(c)'
    requirements:
      - compliance_with_legal_obligation
    aws_mappings:
      - service: 'CloudTrail'
        implementation:
          - legal_hold_capabilities
          - compliance_logging

  vital_interests:
    article: '6(1)(d)'
    requirements:
      - protection_of_vital_interests
    aws_mappings:
      - service: 'Bedrock'
        implementation:
          - emergency_processing_procedures

  public_task:
    article: '6(1)(e)'
    requirements:
      - task_in_public_interest
      - official_authority_exercise
    aws_mappings:
      - service: 'Tags'
        implementation:
          - public_interest_tag

  legitimate_interests:
    article: '6(1)(f)'
    requirements:
      - legitimate_interests_of_controller
      - balancing_test_performed
      - not_override_data_subject_rights
    aws_mappings:
      - service: 'Documentation'
        implementation:
          - lia_assessments_documented
          - balancing_test_records

# Data Subject Rights
data_subject_rights:
  right_to_information:
    articles: ['13', '14']
    requirements:
      - identity_contact_details_controller
      - dpo_contact_details
      - purposes_and_legal_basis
      - legitimate_interests
      - recipients_of_data
      - third_country_transfers
      - retention_period
      - rights_information
      - right_to_withdraw_consent
      - right_to_lodge_complaint
      - automated_decision_making_info
    aws_mappings:
      - service: 'API Gateway'
        implementation:
          - privacy_notice_endpoint
          - data_processing_info_api
      - service: 'Bedrock'
        implementation:
          - bedrock_processing_transparency

  right_of_access:
    article: '15'
    response_time: '1 month (extendable by 2 months)'
    requirements:
      - confirmation_of_processing
      - copy_of_personal_data
      - processing_purposes
      - categories_of_data
      - recipients
      - retention_period
      - rights_information
      - source_of_data
      - automated_decision_making_info
    aws_mappings:
      - service: 'Lambda'
        implementation:
          - sar_automation_function
          - data_export_function
      - service: 'Bedrock'
        implementation:
          - bedrock_data_extraction_capability
          - knowledge_base_data_retrieval
      - service: 'S3'
        implementation:
          - sar_response_bucket
          - secure_data_export

  right_to_rectification:
    article: '16'
    response_time: '1 month (extendable by 2 months)'
    requirements:
      - inaccurate_data_correction
      - incomplete_data_completion
    aws_mappings:
      - service: 'Lambda'
        implementation:
          - data_rectification_function
      - service: 'Bedrock'
        implementation:
          - bedrock_knowledge_base_update_api
      - service: 'DynamoDB'
        implementation:
          - update_procedures_documented

  right_to_erasure:
    article: '17'
    response_time: '1 month (extendable by 2 months)'
    grounds:
      - no_longer_necessary
      - consent_withdrawn
      - objection_to_processing
      - unlawful_processing
      - legal_obligation
      - child_consent_services
    aws_mappings:
      - service: 'Lambda'
        implementation:
          - automated_deletion_function
          - cascading_deletion_logic
      - service: 'Bedrock'
        implementation:
          - bedrock_knowledge_base_deletion
          - bedrock_agent_data_purge
      - service: 'S3'
        implementation:
          - object_deletion_with_versions
          - permanent_deletion_capability
      - service: 'CloudTrail'
        implementation:
          - deletion_requests_logged

  right_to_restriction:
    article: '18'
    response_time: '1 month (extendable by 2 months)'
    grounds:
      - accuracy_contested
      - unlawful_processing
      - no_longer_needed_but_required_for_legal_claims
      - objection_pending_verification
    aws_mappings:
      - service: 'DynamoDB'
        implementation:
          - restriction_flag_attribute
          - processing_status_tracking
      - service: 'Bedrock'
        implementation:
          - bedrock_processing_restriction_flag
      - service: 'Lambda'
        implementation:
          - restriction_enforcement_logic

  right_to_data_portability:
    article: '20'
    response_time: '1 month (extendable by 2 months)'
    requirements:
      - structured_commonly_used_format
      - machine_readable_format
      - transmit_to_another_controller
    aws_mappings:
      - service: 'Lambda'
        implementation:
          - data_export_json_csv_xml
          - automated_portability_function
      - service: 'S3'
        implementation:
          - secure_export_bucket
          - pre_signed_url_generation
      - service: 'Bedrock'
        implementation:
          - bedrock_data_export_api

  right_to_object:
    article: '21'
    response_time: '1 month (extendable by 2 months)'
    grounds:
      - processing_based_on_legitimate_interests
      - processing_for_direct_marketing
      - processing_for_scientific_research
    aws_mappings:
      - service: 'Lambda'
        implementation:
          - objection_processing_function
          - marketing_opt_out_function
      - service: 'Bedrock'
        implementation:
          - bedrock_processing_cessation
      - service: 'DynamoDB'
        implementation:
          - objection_status_tracking

  automated_decision_making:
    article: '22'
    requirements:
      - not_subject_to_solely_automated_decisions
      - right_to_human_intervention
      - right_to_express_point_of_view
      - right_to_contest_decision
    aws_mappings:
      - service: 'Bedrock'
        implementation:
          - bedrock_agent_human_in_loop
          - automated_decision_logging
          - explainability_features
      - service: 'SageMaker'
        implementation:
          - model_explainability_reports
          - clarify_bias_detection

# Security of Processing (Article 32)
security_measures:
  technical_measures:
    requirements:
      - pseudonymisation_encryption
      - ongoing_confidentiality
      - ongoing_integrity
      - ongoing_availability
      - ongoing_resilience
      - restore_availability_after_incident
      - regular_testing_evaluation
    aws_mappings:
      - service: 'KMS'
        controls:
          - encryption_at_rest
          - key_rotation_enabled
          - cmk_for_personal_data
      - service: 'Bedrock'
        controls:
          - bedrock_knowledge_base_encrypted
          - bedrock_data_encrypted_cmk
          - bedrock_vpc_endpoint_encryption
      - service: 'VPC'
        controls:
          - network_isolation
          - private_subnets
          - security_groups_restrictive
      - service: 'Backup'
        controls:
          - automated_backups
          - cross_region_replication
          - backup_vault_locked
      - service: 'GuardDuty'
        controls:
          - threat_detection
          - anomaly_detection
      - service: 'CloudWatch'
        controls:
          - availability_monitoring
          - performance_metrics

  organizational_measures:
    requirements:
      - data_protection_policies
      - staff_training
      - confidentiality_agreements
      - incident_response_procedures
    aws_mappings:
      - service: 'IAM'
        controls:
          - least_privilege_access
          - role_based_access_control
          - access_reviews_quarterly
      - service: 'CloudTrail'
        controls:
          - comprehensive_audit_logging
          - log_file_validation

  risk_assessment:
    factors:
      - state_of_the_art
      - implementation_costs
      - nature_scope_context_purposes
      - risk_of_varying_likelihood_severity
    frequency: 'Annual or after significant changes'
    aws_mappings:
      - service: 'Security Hub'
        implementation:
          - security_score_tracking
          - findings_risk_assessment
      - service: 'Inspector'
        implementation:
          - vulnerability_risk_scoring
          - network_exposure_assessment

# Data Protection Impact Assessment (Article 35)
dpia:
  mandatory_scenarios:
    - systematic_extensive_automated_processing_with_legal_effects
    - large_scale_processing_special_categories
    - systematic_monitoring_publicly_accessible_areas
    - bedrock_agents_processing_sensitive_personal_data

  assessment_elements:
    - systematic_description_of_processing
    - purposes_of_processing
    - legitimate_interests
    - necessity_proportionality_assessment
    - risks_to_data_subjects
    - measures_to_address_risks
    - safeguards_security_measures
    - demonstrate_compliance

  aws_mappings:
    - service: 'Audit Manager'
      implementation:
        - dpia_assessment_framework
        - automated_evidence_collection
    - service: 'Security Hub'
      implementation:
        - risk_findings_aggregation
        - security_posture_assessment
    - service: 'Bedrock'
      implementation:
        - bedrock_processing_risk_assessment
        - bedrock_safeguards_documentation

  consultation_with_dpo:
    required: true

  consultation_with_supervisory_authority:
    condition: 'High risk remains after mitigation'

# Data Breach Notification (Articles 33-34)
data_breach:
  notification_to_supervisory_authority:
    article: '33'
    timeline: '72 hours of becoming aware'
    exemption: 'Unlikely to result in risk to rights and freedoms'
    content:
      - nature_of_breach
      - categories_approximate_number_data_subjects
      - categories_approximate_number_records
      - dpo_contact_details
      - likely_consequences
      - measures_taken_or_proposed
    aws_mappings:
      - service: 'GuardDuty'
        implementation:
          - breach_detection_automated
          - security_findings_critical_alerts
      - service: 'Macie'
        implementation:
          - sensitive_data_exposure_detection
          - unauthorized_access_findings
      - service: 'EventBridge'
        implementation:
          - automated_incident_notifications
          - breach_response_workflow
      - service: 'SNS'
        implementation:
          - dpo_notification_topic
          - stakeholder_alert_distribution

  notification_to_data_subjects:
    article: '34'
    timeline: 'Without undue delay'
    condition: 'Likely to result in high risk to rights and freedoms'
    exemptions:
      - appropriate_technical_organizational_protection (e.g., encryption)
      - subsequent_measures_ensuring_high_risk_no_longer_likely
      - disproportionate_effort_with_public_communication
    content:
      - nature_of_breach
      - dpo_contact_details
      - likely_consequences
      - measures_taken_or_proposed
    aws_mappings:
      - service: 'SES'
        implementation:
          - breach_notification_email_templates
          - mass_notification_capability
      - service: 'SNS'
        implementation:
          - sms_notification_topics
          - multi_channel_notification
      - service: 'Lambda'
        implementation:
          - automated_subject_notification
          - notification_tracking_logging

# International Data Transfers (Chapter V)
data_transfers:
  adequacy_decision:
    article: '45'
    approved_countries:
      - Andorra
      - Argentina
      - Canada (commercial organizations)
      - Faroe Islands
      - Guernsey
      - Israel
      - Isle of Man
      - Japan
      - Jersey
      - New Zealand
      - Republic of Korea
      - Switzerland
      - United Kingdom
      - Uruguay

  appropriate_safeguards:
    article: '46'
    mechanisms:
      - standard_contractual_clauses
      - binding_corporate_rules
      - approved_code_of_conduct
      - approved_certification_mechanism
    aws_mappings:
      - service: 'AWS Data Processing Addendum'
        implementation:
          - aws_dpa_executed
          - standard_contractual_clauses_incorporated
      - service: 'Compliance'
        certifications:
          - iso_27001
          - iso_27017
          - iso_27018
          - soc_2
      - service: 'Bedrock'
        implementation:
          - bedrock_data_residency_configuration
          - bedrock_regional_endpoints_used

  transfer_impact_assessment:
    requirements:
      - assess_legislation_third_country
      - evaluate_supplementary_measures
      - document_assessment_decision
    aws_mappings:
      - service: 'Documentation'
        implementation:
          - tia_documented
          - supplementary_measures_identified

  data_localization:
    aws_mappings:
      - service: 'S3'
        implementation:
          - bucket_region_restriction
          - replication_controls
      - service: 'Bedrock'
        implementation:
          - bedrock_regional_deployment
          - knowledge_base_region_locked
      - service: 'KMS'
        implementation:
          - regional_kms_keys
          - no_multi_region_keys_for_personal_data

# Data Protection Officer (Articles 37-39)
dpo:
  designation_required:
    conditions:
      - public_authority_processing
      - core_activities_require_systematic_monitoring
      - core_activities_large_scale_special_categories
    aws_mappings:
      - service: 'IAM'
        implementation:
          - dpo_role_created
          - dpo_access_permissions

  position:
    requirements:
      - independence
      - no_conflict_of_interest
      - expert_knowledge
      - adequate_resources
    contact_details_published: true
    reported_to_supervisory_authority: true

  tasks:
    - inform_and_advise_controller_employees
    - monitor_compliance_with_gdpr
    - provide_advice_on_dpia
    - cooperate_with_supervisory_authority
    - act_as_contact_point_for_supervisory_authority

  aws_mappings:
    - service: 'Security Hub'
      implementation:
        - dpo_dashboard_access
        - compliance_status_visibility
    - service: 'CloudTrail'
      implementation:
        - dpo_audit_access
        - processing_activity_visibility

# Records of Processing Activities (Article 30)
records:
  controller_records:
    required_information:
      - controller_representative_contact_details
      - purposes_of_processing
      - categories_of_data_subjects
      - categories_of_personal_data
      - categories_of_recipients
      - third_country_transfers
      - retention_periods
      - security_measures_description
    aws_mappings:
      - service: 'Service Catalog'
        implementation:
          - processing_activity_portfolio
          - bedrock_agent_catalog
      - service: 'Systems Manager'
        implementation:
          - processing_inventory
          - parameter_store_metadata
      - service: 'Bedrock'
        implementation:
          - bedrock_agent_registry
          - knowledge_base_catalog
          - processing_purpose_tags

  processor_records:
    required_information:
      - processor_representative_contact_details
      - categories_of_processing
      - third_country_transfers
      - security_measures_description
    aws_mappings:
      - service: 'Organizations'
        implementation:
          - sub_processor_account_tracking
      - service: 'Service Catalog'
        implementation:
          - third_party_service_catalog

# Automated Compliance Monitoring
automation:
  aws_config_rules:
    - rule_name: 'gdpr-encryption-at-rest'
      applicable_article: '32'
      description: 'Ensure personal data encrypted at rest'

    - rule_name: 'gdpr-encryption-in-transit'
      applicable_article: '32'
      description: 'Ensure personal data encrypted in transit'

    - rule_name: 'gdpr-access-logging'
      applicable_article: '32'
      description: 'Ensure access to personal data is logged'

    - rule_name: 'gdpr-data-retention'
      applicable_article: '5(1)(e)'
      description: 'Ensure data retention policies enforced'

    - rule_name: 'gdpr-bedrock-knowledge-base-encryption'
      applicable_article: '32'
      description: 'Ensure Bedrock knowledge bases encrypted with CMK'

  security_hub_controls:
    - standard: 'AWS Foundational Security Best Practices'
      gdpr_relevant_controls:
        - encryption_controls
        - access_control_controls
        - logging_monitoring_controls

  cloudwatch_alarms:
    - alarm_name: 'gdpr-unauthorized-access'
      metric: 'UnauthorizedAPICallsAlarmMetric'
      article: '32'

    - alarm_name: 'gdpr-root-account-usage'
      metric: 'RootAccountUsageAlarmMetric'
      article: '32'

    - alarm_name: 'gdpr-bedrock-encryption-disabled'
      metric: 'BedrockEncryptionDisabled'
      article: '32'

  lambda_automation:
    - function_name: 'gdpr-sar-automation'
      purpose: 'Automate subject access requests'
      article: '15'

    - function_name: 'gdpr-deletion-automation'
      purpose: 'Automate right to erasure'
      article: '17'

    - function_name: 'gdpr-data-portability'
      purpose: 'Automate data portability requests'
      article: '20'

    - function_name: 'gdpr-breach-notification'
      purpose: 'Automate breach notification workflow'
      articles: ['33', '34']

# Penalties (Article 83)
administrative_fines:
  tier_1:
    max_fine: '€10,000,000 or 2% of annual global turnover (whichever higher)'
    violations:
      - insufficient_technical_measures (Article 32)
      - insufficient_dpia (Article 35)
      - insufficient_consultation_with_sa (Article 36)

  tier_2:
    max_fine: '€20,000,000 or 4% of annual global turnover (whichever higher)'
    violations:
      - basic_principles_violations (Article 5)
      - lawful_basis_violations (Article 6)
      - data_subject_rights_violations (Articles 15-22)
      - international_transfer_violations (Chapter V)

  assessment_factors:
    - nature_gravity_duration_of_infringement
    - intentional_or_negligent_character
    - actions_to_mitigate_damage
    - degree_of_responsibility
    - relevant_previous_infringements
    - degree_of_cooperation_with_supervisory_authority
    - categories_of_personal_data_affected
    - manner_sa_became_aware_of_infringement
    - compliance_with_previously_ordered_measures
    - adherence_to_codes_of_conduct
    - other_aggravating_or_mitigating_factors

# Evidence Collection
evidence_collection:
  continuous:
    - cloudtrail_logs (all API activity)
    - config_snapshots (configuration compliance)
    - vpc_flow_logs (network activity)
    - bedrock_invocation_logs (AI processing activity)
    - access_logs (S3, ALB, CloudFront)

  periodic:
    - access_reviews (quarterly)
    - dpia_reviews (annual or when changes)
    - policy_reviews (annual)
    - training_completion_records
    - vendor_assessments

  incident_based:
    - breach_investigation_reports
    - incident_response_logs
    - forensic_analysis_results
    - notification_confirmations

  retention_period: 'As required by applicable law (typically 6+ years)'
